#!/bin/bash

printenv
pwd
ls /tmp
ls /tmp/scripts
ls /tmp/src

# Global S2I variable setup
# source `dirname "$0"`/s2i-setup

# Local vars setup with defaults
S2I_DESTINATION=${S2I_DESTINATION:-/tmp}
S2I_SOURCE_DIR="${S2I_DESTINATION}/src"
S2I_ARTIFACTS_DIR="${S2I_DESTINATION}/artifacts"
DEPLOYMENTS_DIR="/deployments"


# Maven arguments setting up the environment
maven_env_args="-Dmaven.repo.local=${S2I_ARTIFACTS_DIR}/m2"

DEFAULT_KARAF_MAVEN_ARGS="install -DskipTests -e"

# Helper functions:
function check_error() {
  local label=$1
  local error=$2
  if [ ${error} -ne 0 ]; then
    echo "Aborting due to error code $error for $label"
    exit ${error}
  fi
}

# echo error message and exit with error code
function error_exit() {
  echo $1
  if [ -z "$2" ]; then
    exit 1
  fi
  exit $2
}

echo "=================================================================="
echo "Starting S2I Karaf Build ..... WITH CUSTOM STUFFS!"

LOCAL_SOURCE_DIR="${S2I_SOURCE_DIR}"
mkdir -p ${LOCAL_SOURCE_DIR}

echo "contents of src dir...!"
ls ${LOCAL_SOURCE_DIR}

echo "contents of src/shell dir...!"
ls ${LOCAL_SOURCE_DIR}/shell

echo "contents of src/main/fabric8 dir...!"
ls ${LOCAL_SOURCE_DIR}/main/fabric8

# Output will result in ${DEPLOYMENTS_DIR} folder
mkdir -p ${DEPLOYMENTS_DIR}


### COMMENTS FROM HERE ON